✅ 覚えておくべきコード 3つ
① グループ集計（ランキング）

カテゴリやサプライヤーごとの合計を出すときの基本形です。

# サプライヤー別の不良数ランキング
supplier_counts = (
    df.groupby("サプライヤー")["不良数"]
      .sum()
      .sort_values(ascending=False)
)
print(supplier_counts)


👉 groupby + sum() + sort_values() の組み合わせは 鉄板。

② 月ごとの推移（クロス集計）

時系列データをカテゴリごとに広げて分析する形。

# 月別 × 不良カテゴリの推移
monthly_trend = (
    df.groupby(["年月", "不良カテゴリ"])["不良数"]
      .sum()
      .unstack()
      .fillna(0)
)
print(monthly_trend)


👉 unstack() で「ピボットテーブル風」になるのを覚えると強力。

③ Excel出力 + グラフ埋め込み

結果をExcelに書き出して、報告用にまとめるコード。

output_file = "レポート.xlsx"
with pd.ExcelWriter(output_file, engine="xlsxwriter") as writer:
    # 集計表を書き込み
    supplier_counts.to_excel(writer, sheet_name="サプライヤー別集計")

    # グラフを作成
    workbook  = writer.book
    sheet = writer.sheets["サプライヤー別集計"]
    chart = workbook.add_chart({"type": "column"})
    chart.add_series({
        "categories": ["サプライヤー別集計", 2, 0, len(supplier_counts)+1, 0],
        "values":     ["サプライヤー別集計", 2, 1, len(supplier_counts)+1, 1],
    })
    chart.set_title({"name": "サプライヤー別 不良数"})
    sheet.insert_chart("D2", chart)


👉 with pd.ExcelWriter(..., engine="xlsxwriter") の中でやるのがポイント。

💡 まとめ

groupby集計（ランキング出す基本）

unstackでクロス集計（月別推移など）

ExcelWriter + グラフ（レポート出力）

この3つをマスターすれば、だいたいの「工場データ分析→レポート作成」フローは回せます 💪
