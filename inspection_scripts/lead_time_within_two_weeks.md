# 納入日分析: 発注日と納入予定日の差が2週間以内の行を抽出するPythonスクリプト

## 目的

このスクリプトは、Excelファイル「納入日分析_不要列削除版.xlsx」に含まれるデータから、発注日と納入予定日の間のリードタイム（日数）が2週間（14日）以内の行を抽出するためのものです。納期が極端に短い発注を把握し、納入スケジュールの改善や担当者への注意喚起に役立てることを想定しています。

## 実装のポイント

### 1. データの読み込み

- `pandas.read_excel()` でExcelファイルを読み込みます。対象のファイル名やシート名は適宜変更してください。

### 2. 日付列の変換

- `発注日` と `納入予定日` は文字列やExcelの日付形式で保存されている可能性があるため、`pd.to_datetime()` を使って `datetime` 型に変換します。
- `errors="coerce"` を指定することで、変換できない値は `NaT`（欠損）になります。欠損値を無視して計算します。

### 3. リードタイム（日数）の計算

- `納入予定日 - 発注日` により `timedelta` 型の差分が得られます。`.dt.days` プロパティを使って差分を日数に変換し、新しい列 `リードタイム(日)` として追加します。

### 4. フィルタリング条件

- リードタイムが14日以下（`<= 14`）の行を抽出する条件式でフィルタリングします。
- 数値以外（`NaN`）のリードタイムはフィルタに含まれません。

### 5. 結果の確認と保存

- 抽出したデータは `filtered_df` というDataFrameに保存されます。
- `head()` で先頭数件を表示することで結果を確認できます。
- 必要に応じて `filtered_df.to_excel('納入日分析_抽出結果.xlsx', index=False)` などで抽出結果を別のファイルに書き出せます。

## サンプルコード

以下は実際に使用したサンプルコードです。14日を閾値としていますが、条件を変更する場合は `<= 14` の数値を適宜変更してください。

```python
import pandas as pd

# 1) Excelファイルの読み込み
file_path = "納入日分析_不要列削除版.xlsx"
df = pd.read_excel(file_path)

# 2) 日付列を datetime 形式に変換
df["発注日"] = pd.to_datetime(df["発注日"], errors="coerce")
df["納入予定日"] = pd.to_datetime(df["納入予定日"], errors="coerce")

# 3) 発注日と納入予定日の差（リードタイム）を計算
df["リードタイム(日)"] = (df["納入予定日"] - df["発注日"]).dt.days

# 4) リードタイムが14日以下の行を抽出
filtered_df = df[df["リードタイム(日)"] <= 14]

# 結果の確認（先頭10件を表示）
print(filtered_df[["発注NO", "品目コード", "発注日", "納入予定日", "リードタイム(日)"]].head(10))

# 5) 必要なら結果をファイルに保存
# filtered_df.to_excel("納入日分析_抽出結果.xlsx", index=False)
