
# 📝 pandasで検査具リストから合計工数を算出する

## 目的
- 部品ごとの検査具リストをもとに、**標準工数の合計**を求める  
- 「or」パターンは平均を採用する  
- 最終結果を Excel に出力する  

---

## コード例
```python
import pandas as pd
import ast

# === データ読み込み ===
df_tools = pd.read_excel("tools_list_by_part.xlsx")   # 検査具リスト
df_kosu  = pd.read_excel("src/検査工数.xlsx")         # 標準工数表

# 標準工数辞書を作成
kosu_dict = df_kosu.set_index("記号")["標準工数"].to_dict()

results = []
for _, row in df_tools.iterrows():
    plan_no = row["検査計画書品番"]
    tools_list_str = row["検査具リスト"]

    if pd.isna(tools_list_str):
        total_time = 0
    else:
        tools_list = ast.literal_eval(tools_list_str)
        total_time = 0
        for tool in tools_list:
            if "or" in tool:  # 選択肢パターン
                options = [opt.strip() for opt in tool.split("or")]
                std_times = [float(kosu_dict[o]) for o in options if o in kosu_dict and pd.notna(kosu_dict[o])]
                if std_times:
                    total_time += sum(std_times) / len(std_times)  # 平均
            else:
                if tool in kosu_dict and pd.notna(kosu_dict[tool]):
                    total_time += float(kosu_dict[tool])

    results.append({"検査計画書品番": plan_no, "合計標準工数": total_time})

# === 出力 ===
df_result = pd.DataFrame(results)
df_result.to_excel("検査計画書品番_合計標準工数.xlsx", index=False)
```

---

## ポイント
- **辞書化 (`to_dict`)** で工数表を高速参照できる  
- **"or"** → 平均を取るルール  
- 欠損（NaN）は **0 とみなす**  

---

## 追加Tips
### ⏱ 工数（HH:MM:SS）を秒に変換
```python
df['工数（秒）'] = pd.to_timedelta(df['工数']).dt.total_seconds()
```

### 🔗 部品番号＋Ver.列を連結
```python
df['Ver.'] = df['Ver.'].astype(str).str.replace('_','').str.replace(' ','')
df['品目コード'] = df['部品番号'].astype(str) + df['Ver.']
```

---

## まとめ
- 検査具リストと工数表を組み合わせることで、**部品ごとの合計工数**を算出できる  
- 工数の集計ルール（平均・合計・最大など）は業務要件に応じて変更可能  
- 出力形式は Excel なので、社内共有も容易  
